TODO put some text here


\section{Overview of PTtools}
PTtools is a simulation software for modeling the velocity and enthalpy profile of the fluid shell of a single bubble,
and for converting the profile to a gravitational wave spectrum using the sound shell model.
In this thesis PTtools has been extended to support arbitrary equations of state in addition to the bag model.
PTtools is a Python library, which uses
\href{https://numpy.org/}{Numpy}
and
\href{https://scipy.org/}{SciPy}
for the numerical simulations,
\href{https://numba.pydata.org/}{Numba}
for speeding up the computations and
\href{https://matplotlib.org/}{Matplotlib}
and
\href{https://plotly.com/}{Plotly}
for plotting.

To use PTtools, the user has to first specify the equation of state.
They can either use the provided bag model (\texttt{BagModel}) or constant sound speed model (\texttt{ConstCSModel}),
or they can specify their own model by either inheriting from the provided \texttt{Model} class,
or by inheriting from the \texttt{FullModel} class by providing the degrees of freedom $g_e(T,\phi)$ and $g_s(T,\phi)$.
PTtools then runs various validity checks for the model,
including that $V_s - V_b \geq 0$ and that the model has a critical temperature.
As a part of the model initialization, PTtools creates a function for the $c_s^2$ of the model.
This function is compiled using Numba to achieve sufficient performance for using this function in the bubble solving.

Once the model has been specified,
the user can create a bubble by creating an instance of the \texttt{Bubble} class by providing the model, $v_\text{wall}$ and $\alpha_n$.
PTtools then runs various validity checks for the bubble,
including that there exists a nucleation enthalpy $w_n$ and a valid solution type,
and that the nucleation temperature $T_n$ is below the critical temperature.
PTtools also warns if the bubble requires deviations from the local thermal equilibrium to exist.
PTtools then solves the bubble, unless specifically instructed to delay the solving.
The \texttt{Bubble} object has various methods for extracting key quantities such as the thermodynamic quantities of section \ref{energy_redistribution}.

Further details on PTtools are subject to change as the library is being developed,
and available in the PTtools documentation.

In Python the necessary code is as below.
\begin{lstlisting}[language=Python]
from pttools.bubble import Bubble
from pttools.models import ConstCSModel
from pttools.ssmtools import Spectrum

# Specify the equation of state
const_cs = ConstCSModel(a_s=1.5, a_b=1, css2=1/3, csb2=1/3-0.01, V_s=1)

# Create a bubble and solve its fluid profile
bubble = Bubble(const_cs, v_wall=0.5, alpha_n=0.2)
bubble.plot()

# Compute gravitational wave spectrum for the bubble
spectrum = Spectrum(bubble)
spectrum.plot_multi()    
\end{lstlisting}


\section{Bubble solver}
The bubble solver consists of preparatory steps that provide initial values for a numerical solver, the numerical solver itself, and post-processing to provide output data in a consistent form.
For the bag model the user can also choose to use the previous version of the solver which is based on the assumption that $c_s^2 = \frac{1}{3}$.

The generic solver starts by checking the type of the solution based on the conditions of table \ref{table:solution_types}.
If the type of the solution cannot be determined automatically, the solver will halt and request the user to provide the type of the solution.
Then the solver will use the bag model to load reference values for $w_+$ and $w_-$ for the given $v_\text{wall}$ and $\alpha_n$.
If the reference values have not been precomputed, they will be computed and saved to disk at this point.

\todo{Write more about the bubble solver}


\section{Spectrum computation}
TODO write about the spectrum computation


\section{Parallel computing}
PTtools provides an interface for creating multiple bubbles and computing quantities from them in parallel on multiple CPU cores, despite being a Python-based software.
This is made possible by the
\href{https://docs.python.org/3/library/multiprocessing.html}{\texttt{multiprocessing}}
module of the Python standard library.
An example of a parallel program is provided below.

\begin{lstlisting}[language=Python]
from pttools.analysis import BubbleGridVWAlpha
from pttools.bubble import Bubble
from pttools.models import BagModel

def compute(bubble: Bubble):
	if bubble.no_solution_found or bubble.solver_failed:
		return np.nan, np.nan
	return bubble.some_interesting_quantity, bubble.another_interesting_quantity

model = BagModel(V_s=1)
grid = BubbleGridVWAlpha(model, v_walls, alpha_ns, compute)
bubbles = grid.bubbles
some_interesting_quantity_grid = grid.data[0]
another_interesting_quantity_grid = grid.data[1]
\end{lstlisting}
\todo{Remove $V_s$ when it's no longer necessary to specify it.}


\section{Results}
TODO examples here

