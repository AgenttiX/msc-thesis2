\section{General equation of state}
The equation of state is the function $p(T)$ or $p(w)$ that characterises the behaviour of the fluid as a function of temperature $T$ or enthalpy $w$.
It should be highlighted that everything up to this point has been independent of the equation of state.
We will now first describe the derivation for the general equation of state of an ultrarelativistic plasma,
and then introduce approximate models.

\iffalse
In general the pressure of the ultrarelativistic ASDF
\begin{equation}
p(T,\phi) = - \sum_B f_B (m(\phi),T) - \sum_F f_F (m(\phi),T)
\end{equation}
\fi

The energy density at a point is the sum of the energies of all particles at that point.
Therefore the energy density in the position space can be obtained by integrating over the momentum space as
\cite[eq. 4.10]{lecture_notes}
\begin{equation}
e(x) = g_e \int \frac{d^3 p}{(2 \pi)^3} E(p) f(\vec{p}, x).
\end{equation}
This has been multiplied by the degrees of freedom $g_e$ to account for the various species of particles in the plasma, and
\href{https://physics.stackexchange.com/a/141737/}{the factor $(2\pi)^3$ normalises the momentum space}.
Similarly we can obtain the other components of the energy-momentum tensor in the position space as
\todo{Is there an intuitive explanation on why all the components are defined the way they are?}
\cite[eq. 4.13]{lecture_notes}
\begin{equation}
T^{\mu \nu}(x) = \int \frac{d^3 p}{(2 \pi)^3} \frac{p^\mu p^\nu}{p^0} f(\vec{p},x).
\end{equation}
By inserting this to the definition of pressure \eqref{eq:pressure_from_ep_tensor} and multiplying by the degrees of freedom $g_p$ we get
\begin{equation}
p(x) = \frac{g_p}{3} \int \frac{d^3 p}{(2 \pi)^3} \frac{|\vec{p}|^2}{E} f(\vec{p},x)
\end{equation}
This notation is rather confusing, as the $p$ on the left and $g_p$ refer to the pressure,
and all other $p$ on the right refer to the momentum.

The particle distribution functions for fermions and bosons are
\cite[eq. 4.6]{lecture_notes}
\begin{equation}
f(\vec{p}) = \frac{1}{e^\frac{E-\mu}{T} \pm 1},
\end{equation}
where $+$ gives the Fermi-Dirac distribution for fermions and $-$ gives the Bose-Einstein distribution for bosons.
Let us approximate that the fluid consists entirely of bosons,
and that they are ultrarelativistic: $E(\vec{p}) = \sqrt{\vec{p}^2 + m^2} \approx p$.
Particle number is not conserved in an ultrarelativistic plasma, and therefore $\mu = 0$.
Let us also remember that we can convert the integral to 1D using the area of a sphere $A(r) = 4\pi r^2$.
With these we get
\begin{align}
e &= \frac{g_e}{2 \pi^2} \int_0^\infty \frac{p^3 dp}{e^\frac{p}{T} - 1}, \\
p &= \frac{g_p}{6 \pi^2} \int_0^\infty \frac{p^3 dp}{e^\frac{p}{T} - 1}.
\end{align}
These contain integrals of the form
\cite[eq. B.36]{schroeder_thermal_2000}
\begin{equation}
\int_0^\infty \frac{x^n}{e^x - 1} = \Gamma(n+1) \zeta(n+1),
\end{equation}
where $\Gamma$ is the
\href{https://en.wikipedia.org/wiki/Gamma_function}{gamma function}, which for integers is $\Gamma(n) = (n-1)!$.
$\zeta$ is the
\href{https://en.wikipedia.org/wiki/Riemann_zeta_function}{Riemann zeta function}.
It can be shown that $\zeta(4) = \frac{\pi^4}{90}$.
\cite[prob. B.19]{schroeder_thermal_2000}
To also account for the field, we need to add its potential $V$ to the final result
\cite[eq. S12]{borsanyi_lattice_2016}
\begin{align}
e(T,\phi) &= \frac{\pi^2}{30} g_e(T,\phi) T^4 + V(T,\phi),
\label{eq:e_general} \\
p(T,\phi) &= \frac{\pi^2}{90} g_p(T,\phi) T^4 - V(T,\phi).
\label{eq:p_general}
\end{align}

With \eqref{eq:enthalpy_sum}, \eqref{eq:enthalpy_entropy}, \eqref{eq:e_general} and \eqref{eq:p_general} we can obtain the entropy density as
\cite[eq. S12]{borsanyi_lattice_2016}
\begin{equation}
s(T,\phi) = \frac{2\pi^2}{45} g_s(T,\phi) T^3,
\end{equation}
where the degrees of freedom for the entropy density are
\todo{These seem to be in different order than for $\theta$. Have I made a mistake somewhere?}
\begin{equation}
g_s = \frac{1}{4} (3g_p + g_e).
\end{equation}
Often only $g_e$ and $g_s$ are provided, and $g_p$ is obtained with
\begin{equation}
g_p = \frac{1}{3}(4g_s - g_e).
\end{equation}
The case of $g_e=g_p=g_s=1$ is known as the Stefan-Boltzmann limit of a single scalar field.
\iffalse
due to its reminiscence to the Stefan-Boltzmann law $j^* = \sigma T^4$,
which relates the power radiated by a black body to its temperature with the Stefan-Boltzmann constant $\sigma$.
\fi


\section{The bag model}
\label{bag_model}
For phase transitions in the early universe,
the most commonly used equation of state is the bag model, for which
\begin{equation}
g_{e\pm} = g_{p\pm} = g_{s\pm} = \frac{90}{\pi^2} a_\pm,
\end{equation}
where $a_\pm$ are constants with $a_+ > a_-$.
$+$ refers to the symmetric phase, and $-$ refers to the broken phase.
The potentials $V_\pm$ are also constants with $V_+ > V_-$.
This results in the bag equation of state
\todo{Check from Giese whether this is equivalent to "radiation fluid"}
\cites[eq. 7.33]{lecture_notes}[eq. 8-9]{giese_2020}
\begin{equation}
p_\pm = a_\pm T^4 - V_\pm,
\label{eq:bag_p}
\end{equation}
The potential difference $V_+ - V_-$ is the temperature-independent vacuum energy that is released in the phase transition.
In some articles it's denoted with $\epsilon$.
\todo{Add citation to Giese?}
The potentials are usually shifted so that $V_b = 0$.

Using \eqref{eq:energy_density} we get the energy density
\begin{equation}
e_\pm = 4 a_\pm T^4 + V_\pm
\end{equation}
and with \eqref{eq:enthalpy_sum} the enthalpy density
\begin{equation}
w_\pm = 4 a_\pm T^4
\end{equation}

The speed of sound from \eqref{eq:cs2_explicit} simplifies to
\begin{equation}
c_s^2 = \frac{dp}{de} = \frac{dp/dT}{de/dT} = \frac{1}{3}.
\end{equation}
This corresponds to assuming both of the phases to be ultrarelativistic.
It also happens to be the same as the $\tilde{v}_-$ that corresponds to \eqref{eq:v_tilde_plus_limit}, and therefore the Chapman-Jouguet speed $v_{CJ}$ of the bag model is given by \eqref{eq:v_tilde_plus_limit}.

The trace anomaly of \eqref{eq:theta} simplifies to
\begin{align}
\theta_\pm = V_\pm.
\end{align}
Therefore the transition strengths of \eqref{eq:alpha_plus} and \eqref{eq:alpha_n} simplify to
\begin{equation}
\alpha_\text{bag} = \alpha_+ = \alpha_n = \frac{4}{3 w_n} (V_+ - V_-).
\label{eq:alpha_n_bag}
\end{equation}
This is trivial to invert, giving enthalpy at the nucleation temperature $w_n$.

The name of the bag model originates from quantum chromodynamics (QCD), where it's used to describe the proton as a bag of quarks.
\todo{check this}


\section{More complex models}
The bag model is a rather crude approximation, and for realistic simulations a more complex model is needed.
The primary parameters for these models are
\begin{itemize}
    \item The phase transition parameters: percolation temperature, phase transition duration
    \item Bubble wall velocity $v_w$
    \item Fraction of energy that is converted into fluid motion: $\kappa$
    \item Numerical prefactor from lattice simulations
\end{itemize}

Speed of sound may not be ultrarelativistic, especially in the broken phase.

\subsection{The constant sound speed model}
The constant sound speed model, also known as the $\mu_\pm$ model or the $\mu, \nu$ model,
expands the bag model by allowing a different speed of sound in each phase.
It is obtained by setting
\begin{equation}
g_{e\pm} = g_{p\pm} = g_{s\pm} = \frac{90}{\pi^2} a_\pm \left( \frac{T}{T_0} \right)^{\mu_\pm - 4},
\end{equation}
where $\mu_\pm$ are constants.
This results in the equation of state
\cites[eq. 15]{giese_2021}[eq. 38]{giese_2020}
\begin{equation}
p_\pm = a_\pm \left( \frac{T}{T_0} \right)^{\mu_\pm - 4} T^4 - V_\pm {\color{gray} \approx a_\pm T^{\mu_\pm} - V_\pm }, \\
\end{equation}
The reference temperature $T_0$ is introduce for the consistency of the units.
For simplicity it can be set to 1 GeV, or whichever unit one is using for the temperature.
The greyed-out versions are commonly seen in articles and useful, but have inconsistent units.
The parameters $\mu_\pm$ are determined by the sound speeds in the symmetric and broken phases:
\cites[eq. 16]{giese_2021}[eq. 39]{giese_2020}
\footnote{Please note that there is a typo in \cite[eq. 15]{giese_2021}. There the 4 should be a $\mu$.}
\begin{equation}
\mu_\pm = 1 + \frac{1}{c_{s\pm}^2},
\end{equation}
This model reduces to the bag model,
when $c_{s+}^2 = c_{s-}^2 = \frac{1}{3}$
and equivalently
$\mu_+ = \mu_- = 4$.

Similarly as for the bag model we can derive the energy density
\begin{equation}
e_\pm = (\mu_\pm - 1) a_\pm \left( \frac{T}{T_0} \right)^{\mu_\pm - 4} T^4 + V_\pm.
\end{equation}
The enthalpy density is given by
\begin{equation}
w_\pm = \mu_\pm a_\pm \left( \frac{T}{T_0} \right)^{\mu_\pm - 4} T^4.
\end{equation}
This can be inverted to give the temperature as a function of enthalpy
\begin{equation}
T_\pm = T_0 \left( \frac{w}{\mu_\pm a_\pm T_0^4} \right)^\frac{1}{\mu_\pm},
\end{equation}
and the entropy density
\begin{equation}
s_\pm = \mu_\pm a_\pm \left( \frac{T}{T_0} \right)^{\mu_\pm - 4} T_0^3.
\end{equation}
The trace anomaly of \eqref{eq:theta} simplifies to
\begin{equation}
\theta_\pm(w) = \left( \frac{1}{4} - \frac{1}{\mu_\pm} \right) w + V_\pm.
\end{equation}
The transition strength of \eqref{eq:alpha_plus} simplifies to
\begin{equation}
\alpha_+ = \frac{1}{3} \left( 1 - \frac{4}{\mu_+} \right) - \frac{1}{3} \left(1 - \frac{4}{\mu_-} \right) \frac{w_-}{w_+} + \alpha_\text{bag}.
\label{eq:alpha_plus_const_cs}
\end{equation}
The transition strength at nucleation temperature of \eqref{eq:alpha_n} simplifies further to
\begin{equation}
\alpha_n = \frac{4}{3} \left( \frac{1}{\mu_-} - \frac{1}{\mu_+} \right) + \alpha_\text{bag}.
\end{equation}
Inverting this gives the enthalpy at the nucleation temperature
\begin{equation}
w_n = \frac{V_+ - V_-}{ \frac{3}{4} \alpha_n + \frac{1}{\mu_+} - \frac{1}{\mu_-} }.
\label{eq:wn_const_cs}
\end{equation}
\todo{Check that this is correct in PTtools}
When $\mu_- = 4$, $\alpha_+$ of \eqref{eq:alpha_plus_const_cs} becomes independent of $w_-$.
In this case we can obtain $v_{CJ}(\alpha_n, c_{s+})$ analytically by first inserting $\alpha_n$ to \eqref{eq:wn_const_cs} to get $w_n$,
then inserting $w_n$ to \eqref{eq:alpha_plus_const_cs} to get $\alpha_+$, and then $c_{s-}$ and $\alpha_+$ to \eqref{eq:v_tilde_plus} to get $\tilde{v}_+ = v_{CJ}$.

\iffalse
Now we have everything necessary to compute $\alpha_+$ and the Chapman-Jouguet speed $v_{CJ}$ analytically from $c_{s+}$, $c_{s-}$ and $\alpha_n$.
From these we get $w_n$ with \eqref{eq:wn_const_cs}, and for a detonation $w_+=w_n$.
This we can insert to \eqref{eq:wm_const_cs}, giving us $w_-$.
Now we have all the variables necessary to compute $\alpha_+$ with \eqref{eq:alpha_plus}.
Then we insert $\tilde{v}_- = c_{s-}$ to \eqref{eq:v_tilde_plus}, giving us the Chapman-Jouguet speed $v_{CJ} = v_+$.
\todo{This is wrong! We have a circular dependency and must solve the equation group at once.}
\fi


\subsection{Model with cubic thermal effects}
Free energy
\todo{Where does this come from? How to extract the thermal effects?}
\cite[eq. 45]{giese_2020}
\begin{align}
\begin{split}
\textsc{F}(\phi, T) =
&- \frac{a_+}{3} T^4 \\
&+ \lambda \left( \phi^4 - 2E\phi^3 T + \phi^2 \left( E^2 T_\text{cr}^2 + c \left( T^2 - T_\text{cr}^2 \right) \right) \right) \\
&+ \frac{\lambda}{4} \left( c - E^2 \right)^2 T_\text{cr}^4
\end{split}
\end{align}

The minimum of the field potential is given by
\cite[eq. 46]{giese_2020}
\begin{equation}
\phi_\text{min} = \frac{3}{4} ET + \sqrt{\frac{T^2}{2}(\frac{9}{8}E^2 - c) - \frac{T_\text{cr}^2}{2} (E^2 - c)}
\end{equation}


\subsection{Model with a two-step phase transition}
Two scalar fields and two symmetry breakings. Examples: electroweak symmetry, $\mathbb{Z}_2$ symmetry.
Cubic term is neglected.
Pressures are of the form
\cite[eq. 47-48]{giese_2020}
\begin{align}
p_s(T) = \frac{1}{3}a_+ T^4 + (b_+ - c_+ T^2)^2 - b_-^2 \\
p_b(T) = \frac{1}{3}a_+ T^4 + (b_- - c_-T^2)^2 - b_-^2
\end{align}
Compare these to the \eqref{eq:bag_ps}, \eqref{eq:bag_pb}.


\subsection{Standard Model}
In the Standard Model the electroweak phase transition is not of first order but a crossover,
and therefore there is no bubble nucleation.
However, it serves as an important baseline.
The $g_e$ and $g_s$ data for the Standard Model is given by \cite{borsanyi_lattice_2016}.


\section{Energy redistribution}
Efficiency factor $\kappa$, which is the fraction of energy that is converted into fluid motion.
\begin{equation}
\kappa = \frac{3}{\xi_w^3 \Delta \theta} \int d\xi \xi^2 w \gamma^2 v^2
\end{equation}
From solving the hydrodynamic equations of state of a single expanding bubble.

Kinetic energy fraction
\cites[eq. 7.36]{lecture_notes}[eq. 5]{giese_2020}
\begin{align}
K
&= \frac{\rho_\text{fl}}{\bar{e}}
&= \frac{1}{\mathcal{v} \bar{e}} \int d^3 x w \gamma^2 v^2,
\end{align}
where $\mathcal{v}$ is the volume we average over, and $\bar{e}$ is the mean energy density.
It should be noted that $0 < K < 1$.
\cite{giese_2020}

For a single bubble we have, using its volume and the energy density of the symmetric phase that the bubble replaces, the kinetic energy fraction
\cites[eq. 7.37]{lecture_notes}[eq. 5]{giese_2020}
\begin{equation}
K_1 = \frac{3}{\xi_w^3 e_s} \int d\xi \xi^2 w \gamma^2 v^2.
\end{equation}

The kinetic energy fraction can be determined from
\begin{itemize}
\item wall velocity $v_w$
\item the speeds of sound
\item strength parameter of the phase transition
\end{itemize}

Let us define the pseudotrace as
\cites[eq. 34]{giese_2020}[eq. 1]{giese_2021}
\begin{equation}
\overline{\theta} \equiv e - \frac{p}{c_{s,b}^2}.
\end{equation}

For detonations, the optimal phase transition strength is
\cites[eq. 34]{giese_2020}[eq. 1]{giese_2021}
\todo{Todo: Explain how this is defined}
\begin{equation}
\alpha_{\overline{\theta}} \equiv \frac{D \overline{\theta}(T_+)}{3w_+},
\end{equation}


\section{Extensions of the standard model}
Extensions of the Standard model \cite{caprini_detecting_2020}
(mentioned in \cite[p. 14]{lecture_notes})

\section{Noise background}
Non-thermal phenomena: GW production by preheating, when the inflaton decays to SM particles.
\cite{lecture_notes}
